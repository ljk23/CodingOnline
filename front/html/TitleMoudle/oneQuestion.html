<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="../../js/header.js"></script>
    <script src="../../js/common.js"></script>
    <script src="../../js/endindex.js"></script>
    <script src="../../assets/layer/layer.js"></script>
    <link type="text/css" rel="stylesheet" href="../../css/body.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/exercise.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/userInfo.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/header.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/booter.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/probemset.css"/>
</head>
<body id="body">
<!--头部-->
<div class="ui">
    <div class="ui-left">
        <a class="item" href="../IndexMoudle/index.html" onmousemove=""><img src="../../images/logo_flat.png" width="104" height="24"></a>
        <a class="item" href="../TitleMoudle/exercise.html"><i class="list items icon"></i>题目中心</a>
        <a class="item" onclick="warning()"><i class="list items icon"></i>在线教学</a>
        <a class="item" href="../ContestWork/contest.html"><i class="list items icon"></i>在线比赛</a>
        <a class="item" href="../TitleMoudle/submitStatus.html"><i class="list items icon"></i>提交状态</a>
        <a class="item" href="../UserMoudle/userRank.html"><i class="list items icon"></i>选手排名</a>
        <a class="item" href="../HelpMoudle/help.html" style="border-right: 1px solid gray;"><i class="list items icon"></i>帮助中心</a>
    </div>
    <div class="ui-right" id="ui-right">
        <a class="item" onclick="login()">
            <img src="../../images/login.png" width="14px" height="12px" style="margin-right: -20px;"></img>
            <i class="sign in icon" id="banScroll"></i>登录</a>
    </div>
    <script>
        function warning() {
            layer.msg("开发中",{
                icon: 4,
                time: 2000
            })
        }
    </script>
</div>
<!--登录框-->
<div class="loginclass" id="loginclass" style="display: none">
    <form id="#" method="post">
        <div class="loginside"><h4>登录WeJudge</h4></div>
        <hr style="color: gray"/>
        <div class="loginbody">
            <div>WeJudge账户</div>
            <hr width="80%"/>
            <br>
            <small>登录名称</small>
            <br>
            <div style="padding: 10px 10px 10px 0px;"><input type="text" placeholder="请输入账户名和邮箱名" id="username" name="" style="width:200px; height:30px"/></div>
            <small>登录密码</small>
            <br>
            <div style="padding: 10px 10px 10px 0px;"><input type="text" placeholder="请输入密码" id="password" name="" style="width:200px; height:30px"/></div>
            <!--<div>记住登录</div>-->
        </div>
        <div class="loginside"
             style="display: -webkit-box; -webkit-box-orient: horizontal; background-color: #EBEBEB; text-align: center;">
            <div style=" margin-bottom: 5px; width: 50px;margin-left: 40%; background-color: #C2C2C2; border-radius:6px 6px 6px 6px; cursor: pointer; color: #838B83;"
                 id="closelogin">
                <small>关闭</small>
            </div>&nbsp;&nbsp;&nbsp;&nbsp;
            <div style=" margin-bottom: 5px; width: 50px; background-color: #1C86EE; border-radius:6px 6px 6px 6px; cursor: pointer;color: white;"
                 id="login">
                <small>登录</small>
            </div>
        </div>
    </form>
</div>
<!--背景色-->
<div class="operatebackgroud" style="display: none;"></div>
    <div class="ex_nav">
        <img src="../../images/nav_boot.png" width="14" height="13">&nbsp;
        <small style="color: #5CACEE; cursor: pointer" onclick="window.location.href='index.html'">WeJudge首页</small>
        </small>&nbsp;<small>></small>&nbsp;
        <small style="color: #5CACEE; cursor: pointer" onclick="window.location.href='exercise.html'">题目中心</small>
        </small>&nbsp;<small>></small>&nbsp;
        <small id="smallTitle"></small>
    </div>
<!--主体-->
<br>
<div class="ex_page_container one_page">
    <div class="message_marquee">
        <marquee scrollAmount="2" direction=right behavior="scroll">暂无比赛通知!!!</marquee>
    </div>
    <br>
    <!--ProblemDescription-->
    <!--1---problemSet-->
    <div id="one_content_tol" style="display: none">
        <div style="margin: 20px">
            <center>
                <h3><span class="pro_id"></span>.[<span class="pro_name"></span>]</h3><br>
                <small class="one_green">时间限制:</small>
                10 Sed&nbsp;&nbsp;<small>内存限制:</small>
                10MB&nbsp;&nbsp;<br>
                <small>提交:</small>
                1000 Sed&nbsp;&nbsp;<small>解决:</small>
                500&nbsp;&nbsp;<br>
                [
                <a onclick="proCoding()">编码</a> ] [
                <a>状态</a> ] [
                <a>讨论版</a>] [命题人:
                <small class="one_green">外部导入</small>
                ]
            </center>
        </div>
        <h4 style="padding-left: 10px">题目描述</h4>
        <div class="one_content" style="width: 60%">
            <br>
            <div class="problemcontent"></div>
        </div>
        <br>
        <h4 style="padding-left: 10px">输入</h4>
        <div class="one_content">
            <br>
            <div class="probleminput"></div>
        </div>
        <br>
        <h4 style="padding-left: 10px">输出</h4>
        <div class="one_content">
            <br>
            <div class="problemoutput"></div>
        </div>
        <br>
        <h4 style="padding-left: 10px">样本输入</h4>
        <div class="one_content">
            <div class="one_put sampleinput"></div>
        </div>
        <br>
        <h4 style="padding-left: 10px">样本输出</h4>
        <div class="one_content">
            <div class="one_put sampleoutput"></div>
        </div>
        <br>
        <h4 style="padding-left: 10px">提示</h4>
        <div class="one_content">
            <p>language only C/C++</p>
        </div>
    </div>
    <!--2---codingSet-->
    <form method="post">
        <div id="one_coding" style="display: block; display: -webkit-box;-webkit-box-orient: horizontal;">
            <!--题目区-->
            <div class="fenqu domain_1">
                <div>
                    <h3>题目：</h3>
                    <div class="pro_name format"></div>
                    <h3>描述：</h3>
                    <div class="problemcontent format"></div>
                    <h3>样本输入：</h3>
                    <div class="sampleinput format"></div>
                    <h3>样本输出：</h3>
                    <div class="sampleoutput format"></div>
                </div>
            </div>
            <!--编码区-->
            <div class="fenqu domain_2">
                <center>
                    <span>problem:</span>&nbsp;<small>1000</small>
                    <br>
                    <span class="one_green one_code_green">language:&nbsp;<select>
                        <option>C</option>
                        <option>C++</option>
                        <option>JAVA</option>
                    </select></span>&nbsp;&nbsp;
                    <span class="one_green">
                        验证码：<input type="text"/>
                    </span>&nbsp;&nbsp;
                    [<span onclick="oneBackProblem()" class="one_green" style="cursor: pointer;color: #4F94CD;">
                        查看题目
                    </span>]
                    <div id="one_input"></div>
                    <br>
                        <div id="coding_submit"><span>提交</span></div>&nbsp;&nbsp;<div id="coding_state"><span>状态</span></div>
                    <br>
                </center>
            </div>
            <!--题目集-->
            <div class="fenqu domain_3">
                题目集
                <div class="code_upload file_upload"><input type="file" name="file" id="file" value="选择文件"></div>
                <div class="code_upload"><input type="button" value="上传单文件" onclick="clickUPFile();" /></div>
                <div class="code_upload"><input type="button" value="上传代码文件夹" onclick="clickZipFile();"></div>
            </div>
        </div>
    </form>

</div>
<!--底部-->
<div id="booter"></div>
<script>
    /**select tab  */
    $(function () {
        $("a[class=item]").each(function (index) {
            $(this).mouseover(function () {
                $("a[class=item]").css("backgroundColor", "#1B1C1D");
                $(this).css("backgroundColor", "#515151");
            }).mouseout(function () {
                $("a[class=item]").css("backgroundColor", "#1B1C1D");
            })
        });
        /** 禁止滑动 */
        $("#banScroll").click(function () {
            $(window).scroll(function () {
                $(this).scrollTop(0)
            });
        });
    });
</script>
<script>
    var submitname,submitnameclassfy,submitupdatetime,submituserid;

    /** load function  */
    $(function () {
        $('#one_input').load('../function/codeInput.html');
        $('#booter').load('../booter/booter.html');
        /**  加载题目信息 */
        $(window).load(function () {
            /**  加载get的题目id */
            var problemId =GetQueryString("problemid");
            var submitid=GetQueryString("submitid");
            if(submitid!=null){
                $.ajax({
                    url: "http://localhost:8081/submit/queryBysubmitId",
                    type: 'GET',
                    data: "submitid=" + submitid,
                    success: function (data) {
                        var Info=eval(data);
                        $(".codecontent").text(Info.submitcontent);
                    }
                })
            }

            $.ajax({
                url: "http://localhost:8081/problemAdmin/queryById",
                type: 'GET',
                data: "problemId=" + problemId,
                async: false,
                success: function (data) {
                    var data=eval(data);
                    submitname=data.problemname;
                    submitnameclassfy=data.problemclassfy;
                    submitupdatetime=CurentTime();
                    layer.msg("加载中", {
                        icon:16,
                        shade:[0.1, '#fff'],
                        time: 1000 //取消自动关闭
                    },function () {
                        $(".pro_id").html(data.problemid);
                        $(".pro_name").html(data.problemname);
                        $(".problemcontent").html(data.problemcontent);
                        $(".sampleinput").html(data.probleminput);
                        $(".sampleoutput").html(data.problemoutput);
                        document.getElementById("smallTitle").innerHTML="<a style='color: #5CACEE; text-decoration: none' href='question.html?problemclassfy="+data.problemclassfy+" '>"+data.problemclassfy+"</a>";
                    })
                }
            })
        })
    })
    /** Islogin   */
    $(window).load(function () {
        var loginName = sessionStorage.loginName;
        if (loginName != undefined) {
            var obj = sessionStorage.loginName;
            Implement(obj);
        }
    })
    /**  close login */
    $('#closelogin').click(function () {
        $('#loginclass').css('display', 'none');
        $('.operatebackgroud').css('display', 'none');
        $(window).unbind('scroll');
    })
    /**  close register */
    $('#closeregister').click(function () {
        $('#registerclass').css('display', 'none');
        $('.operatebackgroud').css('display', 'none');
        $(window).unbind('scroll');
    })
    /**  login  */
    $("#login").click(function () {
        var username = $("#username").val();
        var password = $("#password").val();
        $.ajax({
            url: "http://localhost:8081/userInfo/login",
            type: 'POST',
            contentType: 'application/json;charset=utf-8',
            data: '{"username":"' + username + '","password":"' + password + '"}',
            success: function (data) {
                if ($.isEmptyObject(data)) alert("用户名不存在或者密码错误");
                else {
                    /** 退出登录框  */
                    $('#loginclass').css('display', 'none');
                    $('.operatebackgroud').css('display', 'none');
                    $(window).unbind('scroll');
                    /** 更改用户名  */
                    alert("登陆成功");
                    var obj = eval(data);
                    /** session保存信息 */
                    var loginName = obj.username;
                    sessionStorage.loginName = loginName;
                    /**  将变量存储到sessionStorage中，并且value为loginName */
                    Implement(loginName);
                }
            }
        })
    });
</script>
<script>
    function proCoding() {
        $("#one_content_tol").css('display', 'none');
        $("#one_coding").css('display', 'block');
    }

    function oneBackProblem() {
        $("#one_coding").css('display', 'none');
        $("#one_content_tol").css('display', 'block');
    }
</script>
<!--coding submit-->
<script>
    $("#coding_submit").click(function () {
     /** 查找用户的id */
     var  problemid = getUserTransferValue();
     submituserid=SelectUserIdByUsername(sessionStorage.loginName);
        /** 查找用户的信息 */
        var codeInfo={submituserid:submituserid,submitname:submitname,submitnameclassfy:submitnameclassfy,submitnums:1,submitcontent:$(".codecontent").val(),submitupdatetime:submitupdatetime};
        alert(submitnameclassfy);
        if(submitnameclassfy=="词法分析"){
            $.ajax({
                url:  "http://localhost:8081/submit/wordsubmit",
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                data: JSON.stringify(codeInfo),
                success: function (data) {
                    submituserid=eval(data)[1];
                    if(eval(data)[0]==1){
                        layer.alert('编译成功', {
                            icon: 1,
                            time: 2000
                        }, function () {
                            window.location.href="../UserMoudle/userInfo.html?userInfo=user_submit&submituserid="+submituserid+"&problemid="+problemid;
                        });
                    }
                    else{
                        layer.alert('编译失败', {
                            icon: 5,
                            time: 2000
                        }, function () {
                            window.location.href="../UserMoudle/userInfo.html?userInfo=user_submit&submituserid="+submituserid+"&problemid="+problemid;
                        });
                    }
                }
            })
        }
        if(submitnameclassfy=="语法分析"){
            $.ajax({
                url:  "http://localhost:8081/synaxsubmit/synaxsubmit",
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                data: JSON.stringify(codeInfo),
                success: function (data)  {
                    submituserid=eval(data)[1];
                    if(eval(data)[0]==1){
                        layer.alert('编译成功', {
                            icon: 1,
                            time: 2000
                        }, function () {
                            window.location.href="../UserMoudle/userInfo.html?userInfo=user_submit&submituserid="+submituserid+"&problemid="+problemid;
                        });
                    }
                    else{
                        layer.alert('编译失败', {
                            icon: 5,
                            time: 2000
                        }, function () {
                            window.location.href="../UserMoudle/userInfo.html?userInfo=user_submit&submituserid="+submituserid+"&problemid="+problemid;
                        });
                    }
                }
            })
        }
    })
</script>
<script>
    /**  单文件方法   */
    function clickUPFile(){
        //添加获取文件信息
        var formdata=new FormData();
        formdata.append('enctype', 'multipart/form-data');
        formdata.append('name', 'file');
        formdata.append('file',$('#file').get(0).files[0]);
        // formdata.append('recid',str);
        $.ajax({
            url: 'http://localhost:8081/getsubmit/wordsubmit',
            type:'post',
            contentType:false,
            data:formdata,
            processData:false,
            success:function(info){
                layer.msg("提交中", {
                    icon:16,
                    shade:[0.1, '#4F94CD'],
                    time: 3000 //取消自动关闭
                },function () {
                    if(info==1){
                        layer.alert('编写通过', {
                            icon: 1,
                            time: 2000
                        }, function () {

                        })
                    }
                    else if(info==2){
                        layer.alert('答案错误', {
                            icon: 5,
                            time: 2000
                        }, function () {

                        })
                    }
                    else if(info==4){
                        layer.alert('文件格式传入错误', {
                            icon: 5,
                            time: 2000
                        }, function () {

                        })
                    }else{
                        layer.alert('编译失败', {
                            icon: 5,
                            time: 2000
                        }, function () {

                        })
                    }
                })
            }
        });
    }
    /**  多文件上传  */
    function clickZipFile() {
        
    }
</script>
</body>
</html>
